---
phase: 01-infrastructure-and-auth
plan: 03
type: execute
wave: 2
depends_on: [01-01]
files_modified: [scripts/create-bookings-tracker.py, scripts/setup-tracker-formatting.py]
autonomous: false
requirements: [INFRA-05]
user_setup: []

must_haves:
  truths:
    - "Bookings Tracker Google Sheet exists in the shared Drive folder with all 20 columns in the correct order"
    - "Status column has data validation dropdown with exactly 6 states: Received, Details Pending, Details Confirmed, Ready for AP, AP Created, Deployed for Human Review"
    - "Status cells are colour-coded with conditional formatting"
    - "Header row is frozen; no columns are frozen"
    - "Main spreadsheet has 4 tabs: Bookings Tracker, Inbox Queue, Review Queue, Config/Lookups"
    - "Spreadsheet ID is recorded in .env as BOOKINGS_TRACKER_SPREADSHEET_ID"
  artifacts:
    - path: "scripts/create-bookings-tracker.py"
      provides: "Automated Bookings Tracker creation and schema setup"
      min_lines: 80
    - path: "scripts/setup-tracker-formatting.py"
      provides: "Conditional formatting and data validation setup"
      min_lines: 60
  key_links:
    - from: "scripts/create-bookings-tracker.py"
      to: "Google Sheets API"
      via: "Service account authentication"
      pattern: "build.*sheets.*v4"
    - from: ".env"
      to: "Bookings Tracker spreadsheet"
      via: "BOOKINGS_TRACKER_SPREADSHEET_ID"
      pattern: "BOOKINGS_TRACKER_SPREADSHEET_ID"
---

<objective>
Create the Bookings Tracker Google Sheet with full column schema, 4 tabs, data validation, conditional formatting, and frozen header row. Record spreadsheet ID in .env.

Purpose: The Bookings Tracker is the team's daily operational surface — the central spreadsheet where all booking data flows. It must exist with the correct schema before any data can be written by the pipeline.
Output: Bookings Tracker spreadsheet in Google Drive, creation/formatting scripts, .env updated with spreadsheet ID.
</objective>

<execution_context>
@C:/Users/USER/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/USER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure-and-auth/01-RESEARCH.md
@.planning/phases/01-infrastructure-and-auth/01-CONTEXT.md
@.planning/phases/01-infrastructure-and-auth/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Bookings Tracker spreadsheet with full schema</name>
  <files>scripts/create-bookings-tracker.py</files>
  <action>
Create `scripts/create-bookings-tracker.py` — a Python script that uses the Google Sheets API (via service account) to create the complete Bookings Tracker spreadsheet.

**Prerequisites:** `pip install google-auth google-auth-httplib2 google-api-python-client python-dotenv`

The script must:

1. **Authenticate** using service account from GOOGLE_SERVICE_ACCOUNT_PATH in .env
2. **Create spreadsheet** named "DM Ops Hub - Bookings Tracker" in the shared Drive folder (GOOGLE_DRIVE_FOLDER_ID)
3. **Create 4 tabs** (rename default Sheet1 + add 3 more):
   - `Bookings Tracker` (main operational tab)
   - `Inbox Queue` (where polling script writes flagged emails)
   - `Review Queue` (low-confidence classifications for human review)
   - `Config/Lookups` (brand colours, client list, status enum reference)

4. **Set up Bookings Tracker tab columns** (row 1 headers, exact order from CONTEXT.md):
   Column A: Status
   Column B: Client
   Column C: Brand
   Column D: Holding Company
   Column E: Shift Type
   Column F: Base Rate
   Column G: Extras
   Column H: Total Rate
   Column I: Provinces
   Column J: Store List
   Column K: Dates
   Column L: Shift Count
   Column M: Assigned To
   Column N: AP Link
   Column O: Email Source
   Column P: Notes
   Column Q: Completeness %
   Column R: Date Received
   Column S: Last Updated
   Column T: ID

5. **Format header row:**
   - Bold text
   - Light grey background (#f3f3f3)
   - Bottom border

6. **Freeze header row** (row 1 only). Do NOT freeze any columns (per user decision — frozen columns took up ~40% of usable screen in previous experience).

7. **Set reasonable column widths:**
   - Status: 150px
   - Client, Brand, Holding Company: 130px each
   - Shift Type: 100px
   - Base Rate, Extras, Total Rate: 90px each
   - Provinces: 120px
   - Store List, Dates: 150px each
   - Shift Count: 80px
   - Assigned To: 110px
   - AP Link: 200px
   - Email Source: 200px
   - Notes: 250px
   - Completeness %: 100px
   - Date Received, Last Updated: 120px each
   - ID: 80px

8. **Set up Inbox Queue tab headers:**
   Email ID | Subject | From | Received Date | Body Preview | Processed | Flagged Keywords

9. **Set up Review Queue tab headers:**
   Email ID | Subject | Classification | Confidence | Reason | Reviewer | Resolution | Date Added

10. **Set up Config/Lookups tab:**
    - Row 1: "Status Values" header
    - Column A, rows 2-7: The 6 status values (Received, Details Pending, Details Confirmed, Ready for AP, AP Created, Deployed for Human Review)
    - This lookup range is referenced by data validation

11. **Print the spreadsheet ID** to stdout so it can be captured and added to .env

12. **Update .env** with the BOOKINGS_TRACKER_SPREADSHEET_ID value (read current .env, replace placeholder, write back)

**Error handling:** If spreadsheet creation fails, print clear error message. If a spreadsheet with this name already exists, warn but create a new one (don't overwrite).
  </action>
  <verify>
    Run: python scripts/create-bookings-tracker.py
    Expected: Script creates spreadsheet, prints spreadsheet ID, updates .env.
    Verify: grep BOOKINGS_TRACKER_SPREADSHEET_ID .env (should have real ID, not placeholder)
    Verify: Open the spreadsheet URL printed by the script — confirm 4 tabs, 20 columns, header row frozen.
  </verify>
  <done>
    Bookings Tracker spreadsheet exists in the shared Drive folder with 4 tabs, all 20 columns in correct order on Bookings Tracker tab, headers on Inbox Queue and Review Queue tabs, Config/Lookups has status values, header row frozen, .env updated with spreadsheet ID.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add data validation and conditional formatting</name>
  <files>scripts/setup-tracker-formatting.py</files>
  <action>
Create `scripts/setup-tracker-formatting.py` — a Python script that adds data validation and conditional formatting to the existing Bookings Tracker spreadsheet.

**Prerequisites:** Same as Task 1 (google API libraries + python-dotenv)

The script must:

1. **Read spreadsheet ID** from .env (BOOKINGS_TRACKER_SPREADSHEET_ID)
2. **Authenticate** using service account

3. **Add data validation to Status column (A):**
   - Apply to A2:A1000 (leaving header)
   - Dropdown showing exactly 6 values: Received, Details Pending, Details Confirmed, Ready for AP, AP Created, Deployed for Human Review
   - Strict validation (reject invalid input)
   - Use ONE_OF_LIST type with values from Config/Lookups tab range

4. **Add conditional formatting for Status column colours:**
   Choose a professional, scannable colour palette (Claude's discretion per CONTEXT.md):
   - Received: Light blue (#E3F2FD) — new, needs attention
   - Details Pending: Light orange (#FFF3E0) — waiting on client
   - Details Confirmed: Light green (#E8F5E9) — confirmed, moving forward
   - Ready for AP: Green (#C8E6C9) — ready for next step
   - AP Created: Blue (#BBDEFB) — AP is done
   - Deployed for Human Review: Light purple (#F3E5F5) — needs human review

   Apply to rows 2-1000 of column A. Each rule: TEXT_EQ condition with the status value, format = background colour.

5. **Add Completeness % column formula (Claude's discretion):**
   - In Q2, add a formula that counts non-empty cells in B2:P2 (columns B through P = 15 data fields) divided by 15
   - Format as percentage
   - This is a simple COUNTA-based formula; Phase 2 may refine with field-specific weighting
   - Do NOT auto-fill down — leave it in Q2 as a template row; the system will copy it when adding new rows

6. **Print summary** of all formatting applied.

**Run idempotently:** If formatting already exists, the script should still work (Google Sheets API replaces existing conditional formatting rules).
  </action>
  <verify>
    Run: python scripts/setup-tracker-formatting.py
    Expected: Script applies data validation and conditional formatting without errors.
    Manual check: Open Bookings Tracker, click cell A2, verify dropdown appears with 6 status values.
    Manual check: Select "Received" in A2, verify cell turns light blue.
    Manual check: Check Q2 has a Completeness % formula.
  </verify>
  <done>
    Status column (A2:A1000) has data validation dropdown with 6 values. Conditional formatting colours each status distinctly. Completeness % formula template exists in Q2. All formatting is visible and functional in the live spreadsheet.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Bookings Tracker is complete and functional</name>
  <files>scripts/create-bookings-tracker.py, scripts/setup-tracker-formatting.py</files>
  <action>
Bookings Tracker Google Sheet has been created with full schema (20 columns), 4 tabs, data validation on Status column, conditional formatting with colour-coded statuses, frozen header row, and Completeness % formula. Human verifies the live spreadsheet.
  </action>
  <verify>
1. Open the Bookings Tracker spreadsheet (URL printed by creation script)
2. **Tabs check:** Verify 4 tabs exist: Bookings Tracker, Inbox Queue, Review Queue, Config/Lookups
3. **Columns check:** Verify 20 columns in order: Status, Client, Brand, Holding Company, Shift Type, Base Rate, Extras, Total Rate, Provinces, Store List, Dates, Shift Count, Assigned To, AP Link, Email Source, Notes, Completeness %, Date Received, Last Updated, ID
4. **Frozen row check:** Scroll down — header row stays visible. Scroll right — columns scroll freely (no frozen columns).
5. **Data validation:** Click cell A2 → dropdown should appear with 6 status values
6. **Conditional formatting:** Select each status value in A2 and verify the colour changes:
   - Received = blue-ish
   - Details Pending = orange-ish
   - Details Confirmed = light green
   - Ready for AP = green
   - AP Created = blue
   - Deployed for Human Review = purple-ish
7. **Completeness %:** Type test values in B2:P2 (any text), check Q2 shows a percentage
8. **Config/Lookups:** Switch to Config/Lookups tab — verify 6 status values listed
  </verify>
  <done>Bookings Tracker spreadsheet is fully set up: 4 tabs, 20 columns in correct order, data validation on Status, colour-coded conditional formatting, frozen header row, Completeness % formula. Human verified live spreadsheet.</done>
  <resume-signal>Type "approved" if all checks pass, or describe any issues with the tracker layout/formatting.</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. Bookings Tracker spreadsheet exists in shared Google Drive folder
2. 4 tabs present: Bookings Tracker, Inbox Queue, Review Queue, Config/Lookups
3. 20 columns in correct order on Bookings Tracker tab
4. Status column has data validation dropdown with 6 states
5. Conditional formatting colours statuses distinctly
6. Header row frozen, no columns frozen
7. Completeness % formula in Q2
8. BOOKINGS_TRACKER_SPREADSHEET_ID in .env is real (not placeholder)
9. Creation and formatting scripts committed to git
</verification>

<success_criteria>
- The Bookings Tracker Google Sheet exists with all required columns (ID through Completeness %) and correct data validation dropdowns for Status (Success Criterion 3 from ROADMAP)
- Spreadsheet has 4 tabs matching the structure from CONTEXT.md
- Colour-coded statuses visible from day one
- No frozen columns (header row only)
- Scripts are rerunnable for recreation if needed
- .env has real spreadsheet ID
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-and-auth/01-03-SUMMARY.md`
</output>
