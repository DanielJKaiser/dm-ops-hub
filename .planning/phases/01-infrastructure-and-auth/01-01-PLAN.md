---
phase: 01-infrastructure-and-auth
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [.env.example, .env, .gitignore, mcp-config-example.json]
autonomous: false
requirements: [INFRA-01, INFRA-02, INFRA-06]
user_setup:
  - service: azure
    why: "Azure App Registration for Outlook API access"
    env_vars:
      - name: MS_CLIENT_ID
        source: "Azure Portal -> App registrations -> Application (client) ID"
      - name: MS_CLIENT_SECRET
        source: "Azure Portal -> App registrations -> Certificates & secrets -> New client secret -> Value"
      - name: MS_TENANT_ID
        source: "Azure Portal -> App registrations -> Directory (tenant) ID"
    dashboard_config:
      - task: "Create App Registration"
        location: "Azure Portal -> App registrations -> New registration"
      - task: "Add API permissions"
        location: "Azure Portal -> App registrations -> API permissions -> Add a permission -> Microsoft Graph"
      - task: "Create client secret"
        location: "Azure Portal -> App registrations -> Certificates & secrets"
  - service: google-cloud
    why: "Google Cloud project with Sheets API for spreadsheet access"
    env_vars:
      - name: GOOGLE_SERVICE_ACCOUNT_PATH
        source: "GCP Console -> IAM & Admin -> Service accounts -> Keys -> Create new key -> JSON"
      - name: GOOGLE_DRIVE_FOLDER_ID
        source: "Google Drive -> Create folder -> Share with service account email -> Copy folder ID from URL"
    dashboard_config:
      - task: "Create GCP project"
        location: "console.cloud.google.com -> New Project"
      - task: "Enable Google Sheets API"
        location: "GCP Console -> APIs & Services -> Enable APIs -> Google Sheets API"
      - task: "Enable Google Drive API"
        location: "GCP Console -> APIs & Services -> Enable APIs -> Google Drive API"
      - task: "Create service account"
        location: "GCP Console -> IAM & Admin -> Service accounts -> Create"

must_haves:
  truths:
    - "Azure App Registration exists with Mail.Read delegated permission and offline_access"
    - "Mail.ReadWrite is registered in Azure but NOT admin-consented"
    - "Google Cloud project exists with Sheets API and Drive API enabled"
    - "Service account JSON key file exists on disk"
    - "Shared Google Drive folder exists and service account has Editor access"
    - ".env file contains all credential placeholders populated with real values"
    - ".gitignore excludes all secret files"
    - ".env.example committed with placeholder values and documentation"
  artifacts:
    - path: ".env"
      provides: "All project secrets"
      contains: "MS_CLIENT_ID"
    - path: ".env.example"
      provides: "Template for secrets with documentation"
      contains: "MS_CLIENT_ID"
    - path: ".gitignore"
      provides: "Secret exclusion rules"
      contains: ".env"
    - path: "mcp-config-example.json"
      provides: "MCP server configuration template"
      contains: "mcpServers"
  key_links:
    - from: ".env"
      to: "Azure App Registration"
      via: "MS_CLIENT_ID, MS_CLIENT_SECRET, MS_TENANT_ID"
      pattern: "MS_CLIENT_ID"
    - from: ".env"
      to: "Google Cloud service account"
      via: "GOOGLE_SERVICE_ACCOUNT_PATH, GOOGLE_DRIVE_FOLDER_ID"
      pattern: "GOOGLE_SERVICE_ACCOUNT_PATH"
---

<objective>
Create Azure App Registration, Google Cloud project with service account, security baseline files, and credential management foundation.

Purpose: All downstream MCP servers and API integrations depend on these credentials and security patterns being in place first.
Output: .env with real credentials, .env.example with documented placeholders, .gitignore, mcp-config-example.json, service account key on disk.
</objective>

<execution_context>
@C:/Users/USER/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/USER/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure-and-auth/01-RESEARCH.md
@.planning/phases/01-infrastructure-and-auth/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create security baseline files</name>
  <files>.gitignore, .env.example, mcp-config-example.json</files>
  <action>
Create three files that form the project's security and configuration baseline:

1. **.gitignore** — Exclude secrets and generated files:
   - `.env` (secrets)
   - `service-account-key.json` and `*-service-account*.json` (Google credentials)
   - `node_modules/`
   - Do NOT exclude: `package.json`, `package-lock.json`, `mcp-config-example.json`, `.planning/**`

2. **.env.example** — Template with ALL required env vars and inline documentation:
   ```
   # ============================================
   # DM Ops Hub - Environment Variables
   # ============================================
   # Copy this file to .env and fill in real values
   # See SETUP.md for where to find each value
   # ============================================

   # Azure / Microsoft Graph (Outlook MCP + Polling Script)
   MS_CLIENT_ID=your-azure-application-client-id
   MS_CLIENT_SECRET=your-azure-client-secret-value
   MS_TENANT_ID=your-azure-directory-tenant-id

   # Google Cloud (Sheets MCP)
   GOOGLE_SERVICE_ACCOUNT_PATH=./service-account-key.json
   GOOGLE_DRIVE_FOLDER_ID=your-shared-drive-folder-id

   # Bookings Tracker
   BOOKINGS_TRACKER_SPREADSHEET_ID=your-spreadsheet-id-after-creation
   ```

3. **mcp-config-example.json** — MCP server config template for Claude Desktop/Code:
   ```json
   {
     "mcpServers": {
       "outlook": {
         "command": "node",
         "args": ["C:/path/to/outlook-mcp/index.js"],
         "env": {
           "OUTLOOK_CLIENT_ID": "YOUR_AZURE_CLIENT_ID",
           "OUTLOOK_CLIENT_SECRET": "YOUR_AZURE_CLIENT_SECRET"
         }
       },
       "google-sheets": {
         "command": "uvx",
         "args": ["mcp-google-sheets@latest"],
         "env": {
           "SERVICE_ACCOUNT_PATH": "C:/path/to/service-account-key.json",
           "DRIVE_FOLDER_ID": "YOUR_DRIVE_FOLDER_ID"
         }
       }
     }
   }
   ```
  </action>
  <verify>
    Confirm all three files exist: ls .gitignore .env.example mcp-config-example.json
    Confirm .gitignore contains .env exclusion: grep "^\.env$" .gitignore
    Confirm .env.example has all required vars: grep -c "MS_CLIENT_ID\|MS_CLIENT_SECRET\|MS_TENANT_ID\|GOOGLE_SERVICE_ACCOUNT_PATH\|GOOGLE_DRIVE_FOLDER_ID\|BOOKINGS_TRACKER_SPREADSHEET_ID" .env.example
  </verify>
  <done>
    .gitignore excludes .env and service account keys. .env.example has all 6 env vars with documentation comments. mcp-config-example.json has both MCP server configs with placeholder values. All three files committed to git.
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Azure App Registration and Google Cloud project setup</name>
  <files>.env</files>
  <action>
Security baseline files (.gitignore, .env.example, mcp-config-example.json) are committed and ready.

Daniel needs to complete these steps in a browser. Claude will provide step-by-step guidance.

**PART A: Azure App Registration**

1. Go to https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade
2. Click "New registration"
3. Fill in:
   - Name: `dm-ops-hub`
   - Supported account types: "Accounts in this organizational directory only (Single tenant)"
   - Redirect URI: Select "Mobile and desktop applications" platform, set URI to `http://localhost:3333/callback`
4. Click "Register"
5. On the Overview page, copy:
   - **Application (client) ID** → this is MS_CLIENT_ID
   - **Directory (tenant) ID** → this is MS_TENANT_ID
6. Go to "Certificates & secrets" in left sidebar
7. Click "New client secret"
   - Description: `dm-ops-hub-secret`
   - Expires: 24 months
8. Copy the secret **Value** (NOT the Secret ID) → this is MS_CLIENT_SECRET
9. Go to "API permissions" in left sidebar
10. Click "Add a permission" → "Microsoft Graph" → "Delegated permissions"
11. Add these permissions:
    - `offline_access`
    - `User.Read`
    - `Mail.Read`
    - `Mail.ReadWrite` (register but do NOT admin consent — future use)
12. Click "Add a permission" → "Microsoft Graph" → "Application permissions"
13. Add: `Mail.Read` (for Phase 2 polling script)
14. Click "Grant admin consent" for ONLY the delegated permissions (offline_access, User.Read, Mail.Read). Do NOT consent Mail.ReadWrite yet.

**PART B: Google Cloud Project**

1. Go to https://console.cloud.google.com/projectcreate
2. Project name: `dm-ops-hub`
3. Click "Create"
4. After creation, go to APIs & Services → Library
5. Search and enable: **Google Sheets API**
6. Search and enable: **Google Drive API**
7. Go to IAM & Admin → Service accounts
8. Click "Create service account"
   - Name: `dm-ops-hub-sheets`
   - Role: skip (not needed for Sheets API)
9. Click on the created service account → Keys tab → Add key → Create new key → JSON
10. Save the downloaded JSON file as `service-account-key.json` in the dm-ops-hub repo root
11. Copy the service account email (looks like `dm-ops-hub-sheets@dm-ops-hub.iam.gserviceaccount.com`)

**PART C: Google Drive Folder**

1. Go to https://drive.google.com
2. Create a new folder: `DM Ops Hub`
3. Right-click → Share → add the service account email as Editor
4. Open the folder → copy the folder ID from the URL (the long string after `/folders/`)

**PART D: Create .env**

After completing A, B, C — create `.env` in the repo root (copy from .env.example) and fill in:
- MS_CLIENT_ID from step A5
- MS_CLIENT_SECRET from step A8
- MS_TENANT_ID from step A5
- GOOGLE_SERVICE_ACCOUNT_PATH=./service-account-key.json
- GOOGLE_DRIVE_FOLDER_ID from step C4
- BOOKINGS_TRACKER_SPREADSHEET_ID=placeholder (will be filled after Plan 03)
  </action>
  </action>
  <verify>Verify .env exists and contains non-placeholder values for MS_CLIENT_ID, MS_CLIENT_SECRET, MS_TENANT_ID, GOOGLE_SERVICE_ACCOUNT_PATH, GOOGLE_DRIVE_FOLDER_ID. Verify service-account-key.json exists. Verify git status shows neither .env nor service-account-key.json as tracked.</verify>
  <done>Azure App Registration exists with correct permissions. Google Cloud project has Sheets+Drive APIs enabled. Service account key downloaded. Shared Drive folder created. .env populated with real credentials. All secrets excluded from git.</done>
  <resume-signal>Type "done" when Azure App Registration, Google Cloud project, service account, and .env are all set up. Include any issues encountered.</resume-signal>
</task>

</tasks>

<verification>
After both tasks complete:
1. `.gitignore` exists and contains `.env` exclusion
2. `.env.example` committed to git with all 6 environment variables documented
3. `mcp-config-example.json` committed with both MCP server templates
4. `.env` exists locally with real credential values (NOT committed to git)
5. `service-account-key.json` exists in repo root (NOT committed to git)
6. `git status` shows .env and service-account-key.json are NOT tracked
</verification>

<success_criteria>
- Azure App Registration exists with correct permissions (Mail.Read delegated + application, Mail.ReadWrite registered but not consented)
- Google Cloud project exists with Sheets API and Drive API enabled
- Service account key JSON downloaded and accessible
- Shared Drive folder exists with service account as Editor
- .env populated with all real credentials
- .gitignore properly excludes secrets
- .env.example and mcp-config-example.json committed to git
- `git status` confirms no secrets in tracked files
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-and-auth/01-01-SUMMARY.md`
</output>
